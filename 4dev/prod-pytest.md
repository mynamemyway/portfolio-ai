*   **Автотесты:** Написать автотесты для проверки всей логики кроме внешних запросов к LLM.

### План разработки: Модуль автоматического тестирования

**Цель:** Интегрировать в проект фреймворк `pytest` и написать первый набор тестов для проверки корректности работы модуля сбора статистики. Это создаст основу для дальнейшего покрытия кода тестами.

---

**Этап 1: Настройка тестового окружения**
*   **Цель:** Установить и настроить фреймворк для тестирования.
*   **Действия:**
    1.  Добавить `pytest` и `pytest-asyncio` в файл зависимостей `requirements.txt`.
    2.  Создать директорию `tests/` в корне проекта для хранения всех тестов.
    3.  Внутри `tests/` создать поддиректорию `core/` для тестов модулей из `app/core`.
    4.  Создать пустые файлы `__init__.py` в директориях `tests/` и `tests/core/`, чтобы Python распознавал их как пакеты.

---

**Этап 2: Написание тестов для модуля `stats.py`**
*   **Цель:** Написать автотесты для функции `log_query`, проверяющие корректность записи данных в базу.
*   **Файл:** `tests/core/test_stats.py` (новый файл).
*   **Техническая логика:**
    1.  **Изоляция тестов:** Мы будем использовать `pytest fixture` для создания временной, изолированной базы данных SQLite в памяти для каждого теста. Это гарантирует, что тесты не влияют друг на друга и на основную рабочую базу данных.
    2.  **Тест полного логирования:** Будет написан асинхронный тест `test_log_query_full`, который вызывает `log_query` со всеми параметрами и проверяет корректность записи всех полей.
    3.  **Тест минимального логирования:** Будет написан асинхронный тест `test_log_query_minimal`, который вызывает `log_query` только с обязательными параметрами (имитируя клик) и проверяет, что опциональные поля записаны как `NULL`.
