# --- System Prompt рабочий стабильный---

SYSTEM_PROMPT = """
Ты — русскоязычная цифровая копия бэкенд-разработчика на Python Александра, отвечаешь от его лица.
Твоя задача — вежливо, профессионально и дружелюбно отвечать на вопросы собеседника о своём опыте и навыках.
Правила:
1.  Используй предоставленный 'Контекст из базы знаний' как основной источник информации для ответов.
2.  Если в контексте нет ответа, вежливо сообщи, что у тебя нет информации по этому вопросу. Не придумывай факты.
3.  Структурируй ответы, делай их читабельными и локаничными. Используй списки и абзацы.
4.  Вконце каждого ответа предлагай собеседнику три вопроса для продолжения диалога по теме.
5.  Исключи из ответов ссылки и контактную информацию.
6.  Общайся на "Вы", если пользователь не указал иного.
7.  Отвечай только на РУССКОМ языке.
"""

# Задачи:
1. Добавить кнопку About me, которая будет отправлять запрос нейросети:
 "Представься кратко"
2. Добавить отдельные кнопки, которые показываются при нажатии на кнопку Skills:
 - Hard skills (Запрос ИИ: "Составь только структурированный список своих хардскилов, исключая конкретную информацию о проектах.")
 - Soft skills (Запрос ИИ: "Составь только структурированный список своих софтскилов, исключая конкретную информацию о проектах.")
3. Добавить кнопку в раздел Projects "Tell about Portfolio AI" (Запрос ИИ: "Расскажи кратко о работе Portfolio AI бота.") по аналогии с кнопкой "Tell about PrimeNetworking" 
4. Вынести SYSTEM_PROMPT в app/config.py


# План: Расширение UI и рефакторинг конфигурации

**Цель:** Улучшить пользовательский опыт, добавив новые интерактивные кнопки для получения информации, и повысить гибкость системы, вынеся системный промпт в переменные окружения.

---

### Этап 1: Рефакторинг конфигурации

На этом этапе мы вынесем жестко закодированный системный промпт из кода в файл конфигурации, что позволит управлять им через переменные окружения.

#### 1.1. Обновление конфигурационной модели
*   **Цель:** Добавить поле для системного промпта в Pydantic-модель настроек.
*   **Файл:** `app/config.py`
*   **Логика:** В класс `Settings` добавить новое поле `SYSTEM_PROMPT: str` со значением по умолчанию, взятым из текущей реализации.

#### 1.2. Обновление файла-примера `.env`
*   **Цель:** Отразить новую переменную в примере для разработчиков.
*   **Файл:** `.env.example`
*   **Логика:** Добавить переменную `SYSTEM_PROMPT` с многострочным значением, заключенным в двойные кавычки.

#### 1.3. Интеграция в RAG-цепочку
*   **Цель:** Заменить жестко закодированную константу на импорт из `settings`.
*   **Файл:** `app/core/chain.py`
*   **Логика:** Удалить константу `SYSTEM_PROMPT` и в `ChatPromptTemplate` использовать `settings.SYSTEM_PROMPT`.

---

### Этап 2: Слой UI (Клавиатуры)

На этом этапе мы обновим существующие и добавим новые клавиатуры для поддержки нового функционала.

#### 2.1. Модификация главной клавиатуры
*   **Цель:** Добавить кнопку "About me".
*   **Файл:** `app/keyboards.py`
*   **Функция:** `get_main_keyboard()`
*   **Логика:** В `InlineKeyboardBuilder` добавить новую кнопку с `text="About me"` и `callback_data=MainMenuCallback(action="about_me")`.

#### 2.2. Создание подменю для "Skills"
*   **Цель:** Создать отдельную клавиатуру для выбора типа навыков.
*   **Файл:** `app/keyboards.py`
*   **Логика:**
    1.  Создать новую функцию `get_skills_keyboard()`.
    2.  В ней определить клавиатуру с кнопками "Hard skills", "Soft skills" и "⬅️ Return".
    3.  Кнопки "Hard skills" и "Soft skills" будут использовать `MainMenuCallback` с `action="hard_skills"` и `action="soft_skills"` соответственно.
    4.  Кнопка "⬅️ Return" будет использовать `action="back_to_main"`.

#### 2.3. Модификация клавиатуры "Projects"
*   **Цель:** Добавить кнопку для получения информации о текущем проекте.
*   **Файл:** `app/keyboards.py`
*   **Функция:** `get_projects_keyboard()`
*   **Логика:** В `InlineKeyboardBuilder` добавить новую кнопку с `text="Tell about Portfolio AI"` и `callback_data=MainMenuCallback(action="show_project_portfolio_ai")`.

---

### Этап 3: Слой Сервисной Логики (Обработчики)

На этом этапе мы реализуем логику, которая будет реагировать на нажатия новых кнопок.

#### 3.1. Обновление обработчика `callback`-кнопок
*   **Цель:** Добавить и модифицировать логику обработки новых `actions`.
*   **Файл:** `app/handlers/user_handlers.py`
*   **Функция:** `handle_main_menu_button(...)`
*   **Логика:** Внутри `match-case` по `callback_data.action`:
    1.  **`case "about_me"` (новый):** Вызвать `process_query` с предопределенным вопросом: `"Представься кратко"`.
    2.  **`case "skills"` (модификация):** Вместо вызова `process_query`, будет вызываться `_edit_message` для отображения нового подменю `get_skills_keyboard()`.
    3.  **`case "hard_skills"` (новый):** Вызвать `process_query` с вопросом: `"Составь только структурированный список своих хардскилов, исключая конкретную информацию о проектах."`.
    4.  **`case "soft_skills"` (новый):** Вызвать `process_query` с вопросом: `"Составь только структурированный список своих софтскилов, исключая конкретную информацию о проектах."`.
    5.  **`case "show_project_portfolio_ai"` (новый):** Добавить новый `case`, который будет вызывать `process_query` с вопросом: `"Расскажи кратко о работе Portfolio AI бота."`. Существующий `case "show_project_primenet"` остается без изменений.

---

### Этап 4: Тестирование

*   **Цель:** Проверить корректность работы нового функционала.
*   **Логика:**
    1.  **Ручное тестирование:** Запустить бота и последовательно нажать на все новые и измененные кнопки, проверяя, что:
        *   Кнопка "About me" вызывает корректный ответ от LLM.
        *   Кнопка "Skills" открывает подменю.
        *   Кнопки "Hard skills" и "Soft skills" вызывают ответы от LLM.
        *   Кнопка "Tell about Portfolio AI" вызывает ответ от LLM.
        *   Кнопки "Назад" корректно возвращают в предыдущие меню.
    2.  **Обновление автотестов:** Модифицировать `tests/test_handlers.py`, чтобы отразить изменения в поведении кнопки "Skills" (теперь она открывает меню, а не вызывает RAG). Добавить новые тесты для проверки вызова `process_query` для новых кнопок.


# PR: feat(ui): Enhance UI with new buttons and refactor configuration

## Краткое описание

Этот пулл-реквест вносит серию улучшений в пользовательский интерфейс и архитектуру конфигурации. Основная цель — повысить интерактивность бота за счет добавления новых кнопок для быстрого доступа к информации и сделать систему более гибкой, вынеся системный промпт в переменные окружения.

## Ключевые изменения

### 1. Рефакторинг конфигурации (`app/config.py`, `app/core/chain.py`)

*   **Вынос системного промпта:** Жестко закодированный `SYSTEM_PROMPT` был перенесен из `app/core/chain.py` в Pydantic-модель `Settings` в `app/config.py`.
*   **Гибкое управление:** Теперь системным промптом можно управлять через переменные окружения в файле `.env`, что позволяет изменять "личность" AI без вмешательства в код.
*   **Улучшение читаемости:** Для обработки многострочного промпта используется `textwrap.dedent`, что позволяет сохранять чистое форматирование в файле конфигурации.

### 2. Расширение пользовательского интерфейса (`app/keyboards.py`)

*   **Новая кнопка "About me":** Добавлена в главное меню для быстрого получения краткой информации об авторе ИИ генерацией.
*   **Подменю "Skills":** Кнопка "Skills" теперь открывает новое подменю с выбором "Hard skills" и "Soft skills", что делает навигацию по навыкам более структурированной.
*   **Новая кнопка "Tell about Portfolio AI":** В меню "Projects" добавлена кнопка для получения информации о самом проекте `Portfolio AI`.

### 3. Обновление логики обработчиков (`app/handlers/user_handlers.py`)

*   **Адаптация `handle_main_menu_button`:** Обработчик `callback`-кнопок был расширен для поддержки всех новых `actions`:
    *   `case "skills"` теперь открывает подменю вместо прямого вызова RAG.
    *   Добавлены новые `case` для `about_me`, `hard_skills`, `soft_skills` и `show_project_portfolio_ai`, каждый из которых вызывает RAG-цепочку с соответствующим предопределенным вопросом.

### 4. Адаптация автотестов (`tests/`)

*   **Обновлены тесты обработчиков:** Тесты в `tests/test_handlers.py` были полностью переработаны, чтобы соответствовать новой логике. Старый тест для кнопки "Skills" теперь проверяет открытие подменю, а для новых RAG-кнопок создан отдельный параметризованный тест.
*   **Исправлены тесты клавиатур:** Тест `test_get_hello_world_keyboard` в `tests/test_keyboards.py` был исправлен для соответствия актуальному тексту кнопки.

## Результат

*   **Улучшенный UX:** Пользовательский интерфейс стал более интерактивным и интуитивно понятным, предоставляя быстрый доступ к ключевой информации через кнопки.
*   **Повышенная гибкость:** Вынос системного промпта в конфигурацию упрощает его изменение и адаптацию.
*   **Стабильность:** Все изменения полностью покрыты обновленными автотестами, что гарантирует сохранение существующей функциональности и стабильность новой.

## Как тестировать

1.  Запустить бота.
2.  Отправить команду `/start`.
3.  Последовательно протестировать все новые и измененные кнопки:
    *   Нажать "👋 AI about me" -> должен прийти ответ от LLM.
    *   Нажать "Skills" -> должно открыться подменю.
    *   В подменю "Skills" нажать "Hard skills" и "Soft skills" -> должны прийти соответствующие ответы от LLM.
    *   Нажать "Projects" -> должно открыться подменю.
    *   В подменю "Projects" нажать "Tell about Portfolio AI" -> должен прийти ответ от LLM.
4.  Убедиться, что все кнопки "Назад" корректно возвращают в предыдущие меню.
