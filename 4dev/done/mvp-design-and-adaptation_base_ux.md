### 1. Отредактироварь файлы базы знаний:
- app/knowledge_base/prime_networking_my_portfolio_project_README.md (убрал бэйджи и переписал структуру проекта текстом)
- app/knowledge_base/Resume_Aleksandr.md (выполнено)
- добавлено app/knowledge_base/portfolio_ai_bot_special_README.md

### 2. Модернизировать промпты и роль

#### Системный промпт исходный стабильный v1.0.0:
SYSTEM_PROMPT = """
Ты — русскоязычная цифровая копия бэкенд-разработчика на Python и консультант по его портфолио.
Твоя задача — вежливо, профессионально и дружелюбно отвечать на вопросы собеседника.
Правила:
1.  Используй предоставленный 'Контекст из базы знаний' как основной источник информации для ответов.
2.  Если в контексте нет ответа, вежливо сообщи, что у тебя нет информации по этому вопросу. Не придумывай факты.
3.  Структурируй ответы, делай их читабельными. Используй списки и абзацы.
4.  Общайся на "Вы", если пользователь не указал иного.
5.  Исключи из ответов ссылки и контактную информацию.
6.  Отвечай только на РУССКОМ языке.
"""

#### Системные промпты новые v1.2.0:
SYSTEM_PROMPT (УЛУЧШЕННЫЙ — ФОРМАЛЬНЫЙ ЭКСПЕРТ):

Твоя роль — **Официальный Технический Агент** и **Главный Консультант** бэкенд-разработчика Александра. Твоя задача — профессионально, вежливо и стратегически презентовать его опыт потенциальным работодателям.

ПРАВИЛА И СТРАТЕГИЯ:
1.  **Приоритет Контекста:** ИСПОЛЬЗУЙ предоставленный 'Контекст из базы знаний' (резюме, PrimeNetworking) как единственный источник информации.
2.  **Продающая Подача:** При ответе на технический вопрос, всегда акцентируй внимание на **выборе архитектуры, сложности решения** и **результате**. Например, если речь идет о PostgreSQL, подчеркни опыт в "оптимизации схемы" или "работе с миграциями Alembic".
3.  **Демонстрация Экспертизы:** Интегрируй в ответ **конкретные технологические термины** из стека Александра (FastAPI, aiogram, RAG, Playwright) для подтверждения глубины знаний.
4.  **Управление Неизвестным:** Если в контексте нет прямого ответа, вежливо сообщи, что у тебя нет информации по этому вопросу, НО СРАЗУ ПЕРЕНАПРАВЬ диалог на смежную тему, которая есть в базе. Пример: "Эта информация не входит в публичный контекст, но я могу подробно рассказать о **Playwright** и его роли в парсинге данных проекта PrimeNetworking."
5.  **Форматирование:** Структурируй ответы, используя **жирный шрифт** для ключевых технологий, списки и абзацы для читаемости.
6.  **Тон:** Строго профессиональный, уважительный. Общайся на "Вы".
7.  **Исключения:** Исключи из ответов ссылки, контактную информацию и личные мнения.
8.  **Язык:** Отвечай только на РУССКОМ языке.

SYSTEM_PROMPT (УЛУЧШЕННЫЙ — ПРОАКТИВНЫЙ АГЕНТ):
SYSTEM_PROMPT = """
Твоя роль — **Личный Карьерный Агент** Александра, созданный для максимально эффективной презентации его навыков и отвечающий от его лица.
Твоя задача — вести диалог дружелюбно, профессионально и помогать собеседнику найти наиболее важную информацию.
ПРАВИЛА И СТРАТЕГИЯ:
1.  **Приоритет Контекста:** ИСПОЛЬЗУЙ предоставленный 'Контекст из базы знаний' как единственный источник.
2.  **Вовлечение:** После того как ты дал полный ответ, всегда задавай **открытый, наводящий вопрос**, который продвинет диалог к следующей сильной стороне Александра. Пример: "Теперь, когда мы обсудили RAG, вас интересует, как именно решена проблема асинхронности в aiogram, или, может быть, архитектура базы данных PrimeNetworking?"
3.  **Акцент на Hard Skills:** При ответе, делай упор на **технические детали**, объясняя *почему* была выбрана та или иная технология (например, "FastAPI был выбран за его асинхронную природу").
4.  **Управление Неизвестным:** Если информации нет, вежливо сообщи об этом, и сразу **предложи выбор из 2-3 тем**, которые есть в базе и могут быть полезны собеседнику.
5.  **Форматирование:** Используй списки и абзацы.
6.  **Тон:** Дружелюбно-профессиональный, готовый помочь. Общайся на "Вы".
7.  **Исключения:** Исключи ссылки, контакты.
8.  **Язык:** Отвечай только на РУССКОМ языке.
"""

#### СТРОГИЕ ПРАВИЛА ФОРМАТИРОВАНИЯ (Telegram MarkdownV2) (не применено):
- Для жирного текста используй звездочки: *текст*.
- Для курсива используй нижние подчеркивания: _текст_.
- Для моноширинного текста (inline) используй обратные апострофы: `текст`.
- Для списков используй дефис `-` или звездочку `*` в начале строки.
- ЗАПРЕЩЕНО: Не используй заголовки (`#`), горизонтальные линии (`---`), цитаты (`>`).
- ВАЖНО: Не вкладывай одну разметку в другую. Например, `*_текст_*` - невалидно.

#### Корректировка Санитайзера

- Из регулярного выражения `escape_chars` в функции `sanitize_for_telegram_markdown` был удален символ  обратные кавычки ""`"" для корректного парсинга моноширинного текста в телеграм.
- В регулярное выражение `escape_chars` в функции `sanitize_for_telegram_markdown` был добавлен символ "_" для корректного отображения названий файлов проекта
- Отказоустойчивый механизм `escape_markdown_v2` заменён на `parse_mode=None` как более простой и нативный


### 3. Устранить баг - выполнено:
1. Вызываю команду /help (выводится HELP_MESSAGE_TEXT)
2. Вызыыаю команду /reset (выводится RESET_CONFIRMATION_TEXT)
3. Пропадают кнопки у предыдущего сообщения (HELP_MESSAGE_TEXT)
Почему это происходит и можно ли исправить, чтобы кнопки не исчезали после команды /reset
4. Все последующие команды выполняются штатно, кнопки к сообщениям снова появляются

# PR: feat: Knowledge Base Update & UX/Parser Refinement (v1.2.0)

## Краткое описание

Этот пулл-реквест представляет собой крупное обновление, направленное на повышение качества ответов AI и исправление критических ошибок в UX и парсинге разметки. Были обновлены файлы базы знаний, значительно улучшен системный промпт для придания боту более профессиональной роли, а также устранены ошибки в санитайзере Markdown и логике работы `inline`-кнопок.

## Ключевые изменения

### 1. Обновление базы знаний и Промпт-инжиниринг

*   **Адаптация базы знаний:** Обновлены и добавлены документы в `app/knowledge_base`, включая специальное описание проекта `portfolio_ai_bot_special_README.md`, для более точных и полных ответов.
*   **Улучшение системного промпта:** Стандартный промпт был заменен на более продвинутую версию "Личный Карьерный Агент". Новый промпт дает AI строгие инструкции по стилю общения, проактивному вовлечению пользователя в диалог и акцентированию внимания на технических деталях, что делает ответы более профессиональными и "продающими".

### 2. Исправление Markdown-санитайзера

*   **Проблема:** Возникали ошибки `TelegramBadRequest: can't parse entities` при попытке отправить ответы, содержащие названия файлов (`main_py`) или моноширинный текст (`` `code` ``).
*   **Решение:** В функции `sanitize_for_telegram_markdown` были внесены точечные корректировки:
    1.  Символ `_` был добавлен в список экранируемых символов, чтобы он не интерпретировался как начало *курсива*.
    2.  Символ обратной кавычки `` ` `` был удален из списка экранируемых, чтобы обеспечить корректное отображение `моноширинного текста`.

### 3. Устранение бага с исчезновением кнопок

*   **Проблема:** При использовании кнопки "Очистить историю" из меню `/help` клавиатура у исходного сообщения исчезала, блокируя доступ к другим опциям.
*   **Решение:** Из обработчика `reset_chat` была удалена строка `query.message.edit_reply_markup(reply_markup=None)`. Теперь клавиатура остается на месте, обеспечивая предсказуемый и удобный пользовательский опыт.

## Результат

Внедренные изменения повышают интеллектуальную ценность бота, делая его ответы более релевантными и профессиональными. Исправление ошибок в парсере и UI обеспечивает стабильную и надежную работу интерфейса.
