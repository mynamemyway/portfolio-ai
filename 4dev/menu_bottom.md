# План разработки: Интерактивное меню и приветствие с фото

## Введение
Цель этого плана — декомпозировать задачу по добавлению интерактивного меню и фото в приветственное сообщение на последовательные, атомарные шаги. Это обеспечит структурированную и предсказуемую реализацию.

---

### **Этап 1: Слой Базы Данных и Моделей**

На данном этапе изменения не требуются. Вся информация для кнопок меню (навыки, проекты, контакты) будет статичной или запрашиваться у LLM по аналогии с обычными сообщениями. Новые сущности в базе данных не создаются.

---

### **Этап 2: Слой UI (Команды, Клавиатуры и Конфигурация)**

На этом этапе мы определяем все визуальные и конфигурационные компоненты нового интерфейса.

#### **2.1. Определение UI Команд**
*   **Цель:** Определить стандартные команды, которые будут видны в меню Telegram (кнопка "Меню" слева от поля ввода).
*   **Файл:** `app/ui_commands.py` (новый файл).
*   **Логика:** Создать асинхронную функцию `set_ui_commands`, которая будет использовать `bot.set_my_commands()` для установки списка `BotCommand`. Команды: `/start` - Запустить бота, `/help` - Помощь.

#### **2.2. Создание Клавиатур**
*   **Цель:** Создать модуль для генерации `InlineKeyboardMarkup`.
*   **Файл:** `app/keyboards.py` (новый файл).
*   **Логика:**
    1.  Создать `CallbackData` для структурирования данных обратного вызова (например, `MainMenuCallback(action: str)`).
    2.  Создать функцию `get_main_keyboard`, которая возвращает `InlineKeyboardMarkup` с кнопками "Навыки", "Проекты", "Контакты". Каждая кнопка будет использовать `MainMenuCallback` для генерации `callback_data` (например, `main_menu:skills`).

#### **2.3. Обновление Конфигурации**
*   **Цель:** Добавить путь к фотографии в файл конфигурации для гибкости.
*   **Файл:** `app/config.py` и `.env.example`.
*   **Логика:**
    1.  В класс `Settings` в `app/config.py` добавить новое поле `WELCOME_PHOTO_PATH: str | None = None`.
    2.  В файл `.env.example` добавить соответствующую переменную `WELCOME_PHOTO_PATH` с комментарием.

---

### **Этап 3: Слой Сервисной Логики (Обработчики)**

На этом этапе мы реализуем логику, которая будет реагировать на действия пользователя.

#### **3.1. Интеграция UI Команд**
*   **Цель:** Вызвать установку команд при старте бота.
*   **Файл:** `main.py`.
*   **Функция / Сигнатура:** `main()`.
*   **Логика:** В функции `main` перед запуском поллинга (`dp.start_polling(bot)`) добавить вызов `await set_ui_commands(bot)`.

#### **3.2. Обновление Приветственного Сообщения**
*   **Цель:** Модифицировать обработчик `/start` для отправки фото и клавиатуры.
*   **Файл:** `main.py`.
*   **Функция / Сигнатура:** `handle_start(message: Message)`.
*   **Логика:**
    1.  Изменить логику отправки: вместо `message.answer()` использовать `message.answer_photo()`.
    2.  В `answer_photo` передать `photo=FSInputFile(settings.WELCOME_PHOTO_PATH)`, `caption=welcome_message` и `reply_markup=get_main_keyboard()`.
    3.  Добавить проверку, что если `WELCOME_PHOTO_PATH` не задан, отправляется обычное текстовое сообщение с клавиатурой.

#### **3.3. Создание Обработчиков для Кнопок**
*   **Цель:** Реализовать реакцию на нажатие inline-кнопок.
*   **Файл:** `main.py`.
*   **Логика:**
    1.  Создать новый обработчик `handle_main_menu_button(query: CallbackQuery, callback_data: MainMenuCallback, bot: Bot)`.
    2.  Декорировать его с помощью `@router.callback_query(MainMenuCallback.filter())`.
    3.  Внутри обработчика:
        *   Ответить на `callback_query` с помощью `await query.answer()`, чтобы убрать "часики" на кнопке.
        *   В зависимости от `callback_data.action` ("skills", "projects", "contact") определить текст вопроса к LLM (например, "Расскажи о своих навыках").
        *   Вызвать существующую логику обработки сообщения (аналогично `handle_message`), передав ей сформированный вопрос. Это позволит переиспользовать всю RAG-цепочку.

---

### **Этап 4: Тестирование**

*   **Цель:** Проверить корректность работы нового функционала.
*   **Логика:**
    1.  Запустить бота и убедиться, что в меню появились команды `/start` и `/help`.
    2.  Выполнить команду `/start` и проверить, что приходит сообщение с фото и inline-клавиатурой.
    3.  Нажать на каждую кнопку и убедиться, что бот присылает релевантный ответ.
    4.  Проверить, что основной функционал (ответы на произвольные текстовые вопросы) не нарушен.